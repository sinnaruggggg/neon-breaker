<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë„¤ì˜¨ ë¸Œë ˆì´ì»¤ - ê´€ë¦¬ì</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{--primary:#00f0ff;--secondary:#ff00aa;--accent:#ffdd00;--success:#00ff88;--danger:#ff4466;--bg:#0a0a12;--card:#12121f;--text:#fff;--text-dim:#7788aa}
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);font-family:'Rajdhani',sans-serif;color:var(--text);min-height:100vh;padding:15px}
    .container{max-width:800px;margin:0 auto}
    h1{font-family:'Orbitron';font-size:22px;text-align:center;margin-bottom:6px;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .subtitle{text-align:center;color:var(--text-dim);margin-bottom:20px;font-size:12px}
    .status-bar{padding:10px;background:#0a0a12;border-radius:8px;margin-bottom:15px;font-size:11px;display:flex;align-items:center;gap:10px}
    .status-dot{width:10px;height:10px;border-radius:50%;background:var(--danger)}
    .status-dot.ok{background:var(--success)}
    .tabs{display:flex;gap:5px;margin-bottom:15px;flex-wrap:wrap;justify-content:center}
    .tab{padding:10px 18px;background:var(--card);border:2px solid #2a2a40;border-radius:8px;font-family:'Orbitron';font-size:10px;color:var(--text-dim);cursor:pointer}
    .tab:hover{border-color:var(--primary)}
    .tab.active{background:var(--primary);color:#000;border-color:var(--primary)}
    .panel{display:none;background:var(--card);border:2px solid #2a2a40;border-radius:12px;padding:15px}
    .panel.active{display:block}
    .section{margin-bottom:18px}
    .section-title{font-family:'Orbitron';font-size:12px;color:var(--secondary);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid rgba(255,0,170,0.2)}
    .upload-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}
    .upload-card{background:#0a0a12;border:2px solid #2a2a40;border-radius:10px;padding:10px;text-align:center}
    .upload-card.has-image{border-color:var(--success)}
    .upload-card .preview{width:100%;height:80px;background:#050508;border-radius:6px;margin-bottom:8px;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
    .upload-card .preview img,.upload-card .preview video{width:100%;height:100%;object-fit:cover}
    .upload-card .preview .placeholder{color:#333;font-size:28px}
    .upload-card .label{font-family:'Orbitron';font-size:9px;color:var(--text-dim);margin-bottom:6px}
    .upload-card input[type="file"]{display:none}
    .upload-card .upload-btn{width:100%;padding:6px;background:var(--primary);border:none;border-radius:6px;font-family:'Orbitron';font-size:9px;color:#000;cursor:pointer}
    .upload-card .delete-btn{position:absolute;top:4px;right:4px;width:20px;height:20px;background:var(--danger);border:none;border-radius:50%;color:#fff;font-size:10px;cursor:pointer;display:none}
    .upload-card:hover .delete-btn{display:block}
    .round-tabs{display:flex;gap:5px;margin-bottom:12px;flex-wrap:wrap}
    .round-tab{padding:6px 14px;background:#1a1a2f;border:1px solid #2a2a40;border-radius:6px;font-family:'Orbitron';font-size:9px;color:var(--text-dim);cursor:pointer}
    .round-tab.active{border-color:var(--accent);color:var(--accent)}
    .btn{padding:8px 16px;font-family:'Orbitron';font-size:10px;border:none;border-radius:6px;cursor:pointer}
    .btn-primary{background:var(--primary);color:#000}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-ghost{background:transparent;border:1px solid #2a2a40;color:var(--text-dim)}
    .row{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
    .input{padding:8px 12px;background:#0a0a12;border:1px solid #2a2a40;border-radius:6px;color:#fff;font-size:12px}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;margin-bottom:12px}
    .stat-card{background:#0a0a12;border:1px solid #2a2a40;border-radius:8px;padding:10px;text-align:center}
    .stat-card .value{font-family:'Orbitron';font-size:18px;color:var(--accent)}
    .stat-card .label{font-size:9px;color:var(--text-dim)}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);padding:10px 20px;background:rgba(0,0,0,0.95);border:1px solid var(--success);border-radius:20px;font-family:'Orbitron';font-size:10px;color:var(--success);opacity:0;transition:all 0.3s;z-index:999}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .toast.error{border-color:var(--danger);color:var(--danger)}
  </style>
</head>
<body>
  <div class="container">
    <h1>âš™ï¸ ë„¤ì˜¨ ë¸Œë ˆì´ì»¤ ê´€ë¦¬ì</h1>
    <p class="subtitle">Supabase Storage ì—°ë™</p>
    
    <div class="status-bar">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">ì—°ê²° ì¤‘...</span>
    </div>
    
    <div class="tabs">
      <button class="tab active" data-tab="thumbs">ğŸ‘¤ ì¸ë„¤ì¼</button>
      <button class="tab" data-tab="stages">ğŸ¬ ìŠ¤í…Œì´ì§€</button>
      <button class="tab" data-tab="data">ğŸ’¾ ë°ì´í„°</button>
    </div>

    <div class="panel active" id="thumbsPanel">
      <div class="section">
        <div class="section-title">ğŸ‘¤ ìºë¦­í„° ì¸ë„¤ì¼</div>
        <div class="upload-grid" id="thumbsGrid"></div>
      </div>
    </div>

    <div class="panel" id="stagesPanel">
      <div class="section">
        <div class="section-title">ğŸ¬ ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì´ë¯¸ì§€</div>
        <div class="round-tabs" id="roundTabs"></div>
        <div class="upload-grid" id="stagesGrid"></div>
      </div>
    </div>

    <div class="panel" id="dataPanel">
      <div class="section">
        <div class="section-title">ğŸ“Š ê²Œì„ ë°ì´í„°</div>
        <div class="stats-grid" id="statsGrid"></div>
      </div>
      <div class="section">
        <div class="section-title">ğŸ’° ì½”ì¸</div>
        <div class="row">
          <input type="number" class="input" id="coinInput" style="width:100px;">
          <button class="btn btn-primary" onclick="setCoins()">ì„¤ì •</button>
          <button class="btn btn-ghost" onclick="addCoins(1000)">+1ì²œ</button>
          <button class="btn btn-ghost" onclick="addCoins(10000)">+1ë§Œ</button>
        </div>
      </div>
      <div class="section">
        <div class="section-title">âš ï¸ ìœ„í—˜</div>
        <div class="row">
          <button class="btn btn-primary" onclick="unlockAll()">ğŸ”“ ì „ì²´ í•´ê¸ˆ</button>
          <button class="btn btn-danger" onclick="resetData()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>

<script>
var SUPABASE_URL = 'https://ealukkcyetnoouslojaa.supabase.co';
var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhbHVra2N5ZXRub291c2xvamFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5ODkwNjAsImV4cCI6MjA4NDU2NTA2MH0.SQ77IL13Da3FczDKEtEcHwkQCRDKCA1-RaTBjQ5SvE0';

var sb;
var currentRound = 1;

window.onload = async function(){
  sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  await checkConnection();
  setupTabs();
  renderThumbs();
  renderRoundTabs();
  renderStages();
  renderStats();
};

async function checkConnection(){
  try {
    var { data, error } = await sb.storage.from('thumbs').list();
    if(error) throw error;
    document.getElementById('statusDot').classList.add('ok');
    document.getElementById('statusText').textContent = 'Supabase ì—°ê²°ë¨ âœ“';
  } catch(e) {
    document.getElementById('statusText').textContent = 'ì—°ê²° ì‹¤íŒ¨: ' + e.message;
  }
}

function setupTabs(){
  document.querySelectorAll('.tab').forEach(function(tab){
    tab.onclick = function(){
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab + 'Panel').classList.add('active');
    };
  });
}

// ===== ì¸ë„¤ì¼ =====
async function renderThumbs(){
  var grid = document.getElementById('thumbsGrid');
  var html = '';
  for(var i = 1; i <= 6; i++){
    html += '<div class="upload-card" id="thumbCard' + i + '">';
    html += '<div class="preview" id="thumbPrev' + i + '"><span class="placeholder">ğŸ‘¤</span></div>';
    html += '<div class="label">ìºë¦­í„° ' + i + '</div>';
    html += '<input type="file" accept="image/*" id="thumbInput' + i + '" onchange="uploadThumb(' + i + ')">';
    html += '<button class="upload-btn" onclick="document.getElementById(\'thumbInput' + i + '\').click()">ğŸ“· ì—…ë¡œë“œ</button>';
    html += '</div>';
  }
  grid.innerHTML = html;
  
  for(var i = 1; i <= 6; i++) loadThumb(i);
}

async function loadThumb(id){
  var { data } = await sb.storage.from('thumbs').list();
  var file = data.find(f => f.name.startsWith('char_' + id));
  if(file){
    var { data: urlData } = sb.storage.from('thumbs').getPublicUrl(file.name);
    var prev = document.getElementById('thumbPrev' + id);
    prev.innerHTML = '<img src="' + urlData.publicUrl + '?' + Date.now() + '"><button class="delete-btn" onclick="deleteThumb(' + id + ',\'' + file.name + '\')">âœ•</button>';
    document.getElementById('thumbCard' + id).classList.add('has-image');
  }
}

async function uploadThumb(id){
  var input = document.getElementById('thumbInput' + id);
  var file = input.files[0];
  if(!file) return;
  
  toast('ì—…ë¡œë“œ ì¤‘...');
  
  // ê¸°ì¡´ ì‚­ì œ
  var { data: list } = await sb.storage.from('thumbs').list();
  var old = list.filter(f => f.name.startsWith('char_' + id));
  if(old.length) await sb.storage.from('thumbs').remove(old.map(f => f.name));
  
  var ext = file.name.split('.').pop();
  var { error } = await sb.storage.from('thumbs').upload('char_' + id + '.' + ext, file);
  
  if(error) toast('ì‹¤íŒ¨: ' + error.message, true);
  else { toast('ì™„ë£Œ!'); loadThumb(id); }
}

async function deleteThumb(id, name){
  await sb.storage.from('thumbs').remove([name]);
  document.getElementById('thumbPrev' + id).innerHTML = '<span class="placeholder">ğŸ‘¤</span>';
  document.getElementById('thumbCard' + id).classList.remove('has-image');
  toast('ì‚­ì œë¨');
}

// ===== ìŠ¤í…Œì´ì§€ =====
function renderRoundTabs(){
  var html = '';
  for(var r = 1; r <= 6; r++){
    html += '<button class="round-tab' + (r===currentRound?' active':'') + '" onclick="selectRound(' + r + ')">R' + r + '</button>';
  }
  document.getElementById('roundTabs').innerHTML = html;
}

function selectRound(r){
  currentRound = r;
  renderRoundTabs();
  renderStages();
}

async function renderStages(){
  var grid = document.getElementById('stagesGrid');
  var html = '';
  for(var s = 1; s <= 7; s++){
    var key = 'r' + currentRound + '_s' + s;
    html += '<div class="upload-card" id="stageCard_' + key + '">';
    html += '<div class="preview" id="stagePrev_' + key + '"><span class="placeholder">ğŸ¬</span></div>';
    html += '<div class="label">ìŠ¤í…Œì´ì§€ ' + s + '</div>';
    html += '<input type="file" accept="image/*,video/*" id="stageInput_' + key + '" onchange="uploadStage(\'' + key + '\')">';
    html += '<button class="upload-btn" onclick="document.getElementById(\'stageInput_' + key + '\').click()">ğŸ“· ì—…ë¡œë“œ</button>';
    html += '</div>';
  }
  grid.innerHTML = html;
  
  for(var s = 1; s <= 7; s++) loadStage('r' + currentRound + '_s' + s);
}

async function loadStage(key){
  var { data } = await sb.storage.from('secret').list();
  var file = data.find(f => f.name.startsWith(key));
  if(file){
    var { data: urlData } = sb.storage.from('secret').getPublicUrl(file.name);
    var prev = document.getElementById('stagePrev_' + key);
    var isVideo = file.name.endsWith('.mp4') || file.name.endsWith('.webm');
    if(isVideo){
      prev.innerHTML = '<video src="' + urlData.publicUrl + '?' + Date.now() + '" autoplay muted loop></video><button class="delete-btn" onclick="deleteStage(\'' + key + '\',\'' + file.name + '\')">âœ•</button>';
    } else {
      prev.innerHTML = '<img src="' + urlData.publicUrl + '?' + Date.now() + '"><button class="delete-btn" onclick="deleteStage(\'' + key + '\',\'' + file.name + '\')">âœ•</button>';
    }
    document.getElementById('stageCard_' + key).classList.add('has-image');
  }
}

async function uploadStage(key){
  var input = document.getElementById('stageInput_' + key);
  var file = input.files[0];
  if(!file) return;
  
  toast('ì—…ë¡œë“œ ì¤‘...');
  
  var { data: list } = await sb.storage.from('secret').list();
  var old = list.filter(f => f.name.startsWith(key));
  if(old.length) await sb.storage.from('secret').remove(old.map(f => f.name));
  
  var ext = file.name.split('.').pop();
  var { error } = await sb.storage.from('secret').upload(key + '.' + ext, file);
  
  if(error) toast('ì‹¤íŒ¨: ' + error.message, true);
  else { toast('ì™„ë£Œ!'); loadStage(key); }
}

async function deleteStage(key, name){
  await sb.storage.from('secret').remove([name]);
  document.getElementById('stagePrev_' + key).innerHTML = '<span class="placeholder">ğŸ¬</span>';
  document.getElementById('stageCard_' + key).classList.remove('has-image');
  toast('ì‚­ì œë¨');
}

// ===== ë°ì´í„° =====
function renderStats(){
  var coins = parseInt(localStorage.getItem('nb_coins')) || 0;
  var round = parseInt(localStorage.getItem('nb_round')) || 1;
  document.getElementById('coinInput').value = coins;
  document.getElementById('statsGrid').innerHTML = 
    '<div class="stat-card"><div class="value">' + coins.toLocaleString() + '</div><div class="label">ì½”ì¸</div></div>' +
    '<div class="stat-card"><div class="value">' + round + '</div><div class="label">ë¼ìš´ë“œ</div></div>';
}

function setCoins(){
  var v = parseInt(document.getElementById('coinInput').value) || 0;
  localStorage.setItem('nb_coins', v);
  renderStats();
  toast('ì„¤ì •ë¨!');
}

function addCoins(n){
  var v = (parseInt(localStorage.getItem('nb_coins')) || 0) + n;
  localStorage.setItem('nb_coins', v);
  document.getElementById('coinInput').value = v;
  renderStats();
  toast('+' + n.toLocaleString());
}

function unlockAll(){
  var up = {w1:10,w2:10,w3:10,w4:10,s1:5,s2:5,s3:5,s4:5,p_width:10,p_magnet:5,p_catch:5,p_speed:10,p_multi:3,b_dmg:10,b_speed:5,b_size:5};
  localStorage.setItem('nb_upgrades', JSON.stringify(up));
  localStorage.setItem('nb_coins', 99999);
  renderStats();
  toast('ì „ì²´ í•´ê¸ˆ!');
}

function resetData(){
  if(confirm('ì´ˆê¸°í™”?')){ localStorage.clear(); location.reload(); }
}

function toast(msg, err){
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show' + (err ? ' error' : '');
  setTimeout(function(){ t.className = 'toast'; }, 2000);
}
</script>
</body>
</html>
