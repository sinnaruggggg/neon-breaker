<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ë„¤ì˜¨ ë¸Œë ˆì´ì»¤</title>
  
  <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
  <link rel="manifest" href="manifest.json">
  
  <!-- í…Œë§ˆìƒ‰ -->
  <meta name="theme-color" content="#00f0ff">
  
  <!-- Apple PWA ì„¤ì • -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ë„¤ì˜¨ ë¸Œë ˆì´ì»¤">
  <link rel="apple-touch-icon" sizes="192x192" href="assets/icons/icon-192x192.png">
  
  <!-- í°íŠ¸ -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/game.css">
</head>
<body>
  <div id="app">
    <header id="header">
      <div class="hud-group">
        <div class="hud-stat">
          <span class="label">ë¼ìš´ë“œ</span>
          <span class="value" id="hudRound">1-1</span>
        </div>
        <div class="hud-stat">
          <span class="label">ì ìˆ˜</span>
          <span class="value" id="hudScore">0</span>
        </div>
      </div>
      
      <div class="hud-stat">
        <span class="label">ìƒëª…</span>
        <div class="lives-bar" id="livesBar"></div>
      </div>
      
      <div class="hud-group">
        <div class="hud-stat">
          <span class="value gold" id="hudCoins">0</span>
          <span class="label">ì½”ì¸</span>
        </div>
        <button id="pauseBtn">âšâš</button>
      </div>
    </header>

    <main id="gameArea">
      <canvas id="gameCanvas"></canvas>
      <div id="comboPopup"></div>
      <div id="stagePopup"></div>
    </main>

    <section id="controls">
      <div id="weaponInfo">
        <div class="weapon-badge">
          <span id="wpnIcon">ğŸ”«</span>
          <span class="name" id="wpnName">ê¸°ë³¸</span>
        </div>
      </div>
      
      <div id="skillBar">
        <button class="skill-btn" id="skillBtn1">
          <span class="icon">ğŸ’¥</span>
          <span class="label">í­íƒ„</span>
          <div class="cd-fill" id="cd1"></div>
        </button>
        <button class="skill-btn" id="skillBtn2">
          <span class="icon">âš¡</span>
          <span class="label">ë²ˆê°œ</span>
          <div class="cd-fill" id="cd2"></div>
        </button>
        <button class="skill-btn" id="skillBtn3">
          <span class="icon">ğŸ”¥</span>
          <span class="label">í™”ì—¼</span>
          <div class="cd-fill" id="cd3"></div>
        </button>
      </div>
      
      <div id="moveBar">
        <button class="dir-btn" id="leftBtn">â—€</button>
        <button id="fireBtn">ë°œì‚¬</button>
        <button class="dir-btn" id="rightBtn">â–¶</button>
      </div>
    </section>

    <!-- í™”ë©´ë“¤ -->
    <div class="overlay" id="startScreen">
      <div class="overlay-inner">
        <div class="brand">
          <h1>ë„¤ì˜¨ ë¸Œë ˆì´ì»¤</h1>
          <p>ì•„ì¼€ì´ë“œ ì—ë””ì…˜</p>
        </div>
        <div class="coin-badge">
          <span>ğŸª™</span>
          <span class="amount" id="menuCoins">0</span>
        </div>
        <button class="btn btn-primary" id="startBtn">ê²Œì„ ì‹œì‘</button>
        <button class="btn btn-gold" id="shopBtn">ğŸ›’ ìƒì </button>
        <button class="btn btn-ghost" id="adminBtn">âš™ï¸ ê´€ë¦¬ì</button>
      </div>
    </div>

    <div class="overlay hidden" id="gameOverScreen">
      <div class="overlay-inner">
        <div class="brand">
          <h1>ê²Œì„ ì˜¤ë²„</h1>
        </div>
        <div class="reward-card">
          <div class="label">ğŸ’° íšë“</div>
          <div class="amount">+<span id="earnedCoins">0</span></div>
        </div>
        <p style="color:var(--text-dim);margin:10px 0;">
          ìµœì¢… ì ìˆ˜: <span id="finalScore" style="color:var(--primary);">0</span>
        </p>
        <button class="btn btn-secondary" id="continueBtn">ğŸ“º ê´‘ê³  ë³´ê³  ê³„ì†</button>
        <button class="btn btn-ghost" id="menuBtn1">ë©”ì¸ ë©”ë‰´</button>
      </div>
    </div>

    <div class="overlay hidden" id="stageClearScreen">
      <div class="overlay-inner">
        <div class="brand">
          <h1>ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´!</h1>
        </div>
        <div class="reward-card" style="padding:14px;">
          <div class="label">ë³´ìƒ</div>
          <div class="amount" style="font-size:28px;">+<span id="stageReward">0</span> ğŸª™</div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="title">í•´ê¸ˆ ì§„í–‰ë„</span>
            <span id="progressInfo">1/7</span>
          </div>
          <div class="card-body">
            <canvas id="charCanvas"></canvas>
          </div>
          <div class="card-footer">
            <div class="progress-track">
              <div class="progress-bar" id="progressBar" style="width:14%;"></div>
            </div>
          </div>
        </div>
        <button class="btn btn-primary" id="nextStageBtn">ë‹¤ìŒ ìŠ¤í…Œì´ì§€ â†’</button>
      </div>
    </div>

    <div class="overlay hidden" id="roundClearScreen">
      <div class="overlay-inner">
        <div class="brand">
          <h1>ğŸ‰ ë¼ìš´ë“œ í´ë¦¬ì–´!</h1>
          <p>ë¼ìš´ë“œ <span id="clearedRound">1</span></p>
        </div>
        <div class="reward-card">
          <div class="label">ğŸ† ë³´ë„ˆìŠ¤</div>
          <div class="amount">+<span id="roundBonus">500</span></div>
        </div>
        <div class="card">
          <div class="card-header">
            <span class="title">âœ¨ í•´ê¸ˆ ì™„ë£Œ!</span>
          </div>
          <div class="card-body">
            <canvas id="charCanvas2"></canvas>
          </div>
        </div>
        <button class="btn btn-primary" id="nextRoundBtn">ë‹¤ìŒ ë¼ìš´ë“œ â†’</button>
        <button class="btn btn-gold" id="shopBtn2">ğŸ›’ ìƒì </button>
      </div>
    </div>

    <div class="overlay hidden" id="shopScreen">
      <div class="overlay-inner">
        <div style="display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:10px;">
          <div class="brand" style="margin:0;">
            <h1 style="font-size:22px;">ìƒì </h1>
          </div>
          <div class="coin-badge" style="margin:0;">
            <span>ğŸª™</span>
            <span class="amount" id="shopCoins">0</span>
          </div>
        </div>
        
        <div class="shop-tabs">
          <button class="shop-tab active" data-tab="weapons">ë¬´ê¸°</button>
          <button class="shop-tab" data-tab="skills">ìŠ¤í‚¬</button>
          <button class="shop-tab" data-tab="items">ì•„ì´í…œ</button>
          <button class="shop-tab" data-tab="balls">ê³µ</button>
        </div>
        
        <div class="shop-list" id="shopList"></div>
        <button class="btn btn-ghost" id="closeShopBtn">â† ë’¤ë¡œ</button>
      </div>
    </div>

    <div class="overlay hidden" id="pauseScreen">
      <div class="overlay-inner">
        <div class="brand">
          <h1>ì¼ì‹œì •ì§€</h1>
        </div>
        <div class="coin-badge">
          <span>ğŸª™</span>
          <span class="amount" id="pauseCoins">0</span>
        </div>
        <button class="btn btn-primary" id="resumeBtn">ê³„ì†í•˜ê¸°</button>
        <button class="btn btn-gold" id="shopBtn3">ğŸ›’ ìƒì </button>
        <button class="btn btn-ghost" id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>
        <button class="btn btn-ghost" id="menuBtn2">ë©”ì¸ ë©”ë‰´</button>
      </div>
    </div>

    <div id="toast"></div>
  </div>

  <!-- JavaScript -->
  <script src="js/utils/helpers.js"></script>
  <script src="js/utils/input-handler.js"></script>
  <script src="js/data/storage-manager.js"></script>
  <script src="js/data/game-data.js"></script>
  <script src="js/main.js"></script>
  
  <!-- ê¸°ì¡´ ê²Œì„ ìŠ¤í¬ë¦½íŠ¸ (ë‚˜ì¤‘ì— ëª¨ë“ˆí™” ì˜ˆì •) -->
  <script>
    // ê¸°ì¡´ ê²Œì„ ë¡œì§ - ì„ì‹œë¡œ ì¸ë¼ì¸ ìœ ì§€
    // ë‚˜ì¤‘ì— ì™„ì „íˆ ëª¨ë“ˆí™”ë  ì˜ˆì •
    
    window.onload = function() {
      // ê¸°ì¡´ ê²Œì„ ì´ˆê¸°í™” ì½”ë“œ
      console.log('ğŸ® ê¸°ì¡´ ê²Œì„ ë¡œì§ ë¡œë“œ ì¤‘...');
      
      // ê¸°ì¡´ ì½”ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
      if (typeof initializeGame === 'undefined') {
        loadOriginalGameScript();
      }
    };
    
    function loadOriginalGameScript() {
      // ê¸°ì¡´ ê²Œì„ ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ
      const script = document.createElement('script');
      script.innerHTML = `
        // ì—¬ê¸°ì— ê¸°ì¡´ neon-breaker.htmlì˜ JavaScript ì½”ë“œ ì¶”ê°€
        // í˜„ì¬ëŠ” ë‹¨ìˆœí™”ëœ ë²„ì „ìœ¼ë¡œ ì‹œì‘
        
        // ê¸°ë³¸ ë³€ìˆ˜ë“¤
        var canvas, ctx, state = 'menu', score = 0, coins = 0, lives = 4, maxLives = 4;
        var round = 1, stage = 1, charStage = 0, combo = 0, comboTimer, earned = 0;
        var owned = { w_normal: true, b_white: true };
        var equipped = { weapon: 'w_normal', ball: 'b_white' };
        var buffs = {}, passives = {}, hasShield = false;
        var speedLevel = 0, fireRateLevel = 0, bulletCount = 1;
        var skillCD = [0, 0, 0], lastFire = 0;
        var paddle, balls = [], bullets = [], bricks = [], items = [], fx = [], particles = [];
        
        // ê¸°ë³¸ ì„¤ì • (ë‹¨ìˆœí™”)
        var CFG = {
          STAGES: 7,
          CD: [8000, 10000, 12000],
          FIRE_RATE: 1500,
          PADDLE_SPD: 2.5,
          DROP: 0.25
        };
        
        // ê²Œì„ ë£¨í”„ (ê¸°ë³¸ êµ¬ì¡°)
        function update() {
          if (state !== 'playing') return;
          
          // ì—¬ê¸°ì— ê²Œì„ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€
          updateHUD();
        }
        
        function render() {
          if (state !== 'playing' && state !== 'paused') return;
          
          // ê¸°ë³¸ ë Œë”ë§
          var bg = ctx.createLinearGradient(0, 0, 0, canvas.height);
          bg.addColorStop(0, '#08080f');
          bg.addColorStop(0.5, '#0e0e1a');
          bg.addColorStop(1, '#08080f');
          ctx.fillStyle = bg;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        function updateHUD() {
          document.getElementById('hudScore').textContent = score.toLocaleString();
          document.getElementById('hudRound').textContent = round + '-' + stage;
          document.getElementById('hudCoins').textContent = coins.toLocaleString();
          
          var h = '';
          for (var i = 0; i < maxLives; i++) {
            h += '<div class="heart ' + (i < lives ? '' : 'empty') + '"></div>';
          }
          document.getElementById('livesBar').innerHTML = h;
        }
        
        function resize() {
          var a = document.getElementById('gameArea');
          if (canvas && a) {
            canvas.width = a.clientWidth;
            canvas.height = a.clientHeight;
          }
        }
        
        function loop() {
          update();
          render();
          requestAnimationFrame(loop);
        }
        
        // ì´ˆê¸°í™”
        setTimeout(() => {
          canvas = document.getElementById('gameCanvas');
          ctx = canvas.getContext('2d');
          resize();
          window.addEventListener('resize', resize);
          updateHUD();
          loop();
        }, 100);
        
        console.log('âœ… ê¸°ì¡´ ê²Œì„ ë¡œì§ ë¡œë“œë¨');
      `;
      
      document.body.appendChild(script);
    }
  </script>
</body>
</html>